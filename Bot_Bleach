import pyautogui
import time


######### Funcoes para localizar certo elemento da tela e clicar nele #######

def localizar_missoes():
    print('Tentando localizar Missões...')
    try:
        missoes = pyautogui.locateOnScreen('Imagens\\Missoes.png', confidence=0.4)
        print('Missões encontrada \n')
        missoes = pyautogui.center(missoes)
        pyautogui.click(missoes.x, missoes.y)
        time.sleep(0.5)
        return True
    except pyautogui.ImageNotFoundException:
        print('Erro: Imagem "Missões" não encontrada na tela.')
        return False

def localizar_eventos():
    print('Tentando localizar Eventos...')
    while True:
        try:
            eventos = pyautogui.locateOnScreen('Imagens\\Eventos.png', confidence=0.4)
            print('Eventos encontrado \n')
            eventos = pyautogui.center(eventos)
            pyautogui.click(eventos.x, eventos.y)
            time.sleep(3)
            return True
        except pyautogui.ImageNotFoundException:
            print('Erro: Imagem "Eventos" não encontrada na tela.')
            time.sleep(0.5)

def localizar_ev_atual():
    print('Tentando localizar Evento Atual...')
    
    while True:
        try:
            Quest = pyautogui.locateOnScreen('Imagens\\Quest.png', confidence=0.6)
            return True
        except pyautogui.ImageNotFoundException:  
            print("")   
        try:
            EvAtual = pyautogui.locateOnScreen('Imagens\\EvAtual.png', confidence=0.4)
            print('Evento Atual encontrado \n')
            EvAtual = pyautogui.center(EvAtual)
            pyautogui.click(EvAtual.x, EvAtual.y)
            time.sleep(1.5)
            return True
        except pyautogui.ImageNotFoundException:
            print('Erro: Imagem "Evento Atual" não encontrada na tela.Tentando novamente...')
            time.sleep(1)


def localizar_quest():
    print('Tentando localizar Quest...')
    try:
        Quest = pyautogui.locateOnScreen('Imagens\\Quest.png', confidence=0.5)
        print('Quest encontrada \n')
        Quest = pyautogui.center(Quest)
        pyautogui.click(Quest.x, Quest.y)
        time.sleep(1)
        return True
    except pyautogui.ImageNotFoundException:
        print('Erro: Imagem "Quest" não encontrada na tela.')
        return False

def localizar_dificuldade():
    print('Tentando localizar Dificuldade...')
    try:
        Dificuldade = pyautogui.locateOnScreen('Imagens\\Dificuldade.png', confidence=0.5)
        print('Dificuldade encontrada \n')
        Dificuldade = pyautogui.center(Dificuldade)
        pyautogui.click(Dificuldade.x, Dificuldade.y)
        time.sleep(1)
        return True
    except pyautogui.ImageNotFoundException:
        print('Erro: Imagem "Dificuldade" não encontrada na tela.')
        return False

def localizar_prepare_for_quest():
    print('Tentando localizar Prepare for Quest...')
    try:
        PrepreForQuest = pyautogui.locateOnScreen('Imagens\\PrepreForQuest.png', confidence=0.7)
        print('Prepare for Quest encontrado \n')
        PrepreForQuest = pyautogui.center(PrepreForQuest)
        pyautogui.click(PrepreForQuest.x, PrepreForQuest.y)
        return True
    except pyautogui.ImageNotFoundException:
        print('Erro: Imagem "Prepare for Quest" não encontrada na tela.')
        return False

def localizar_start_quest():
    print('Tentando localizar Start Quest...')
    while True:
        try:
            StartQuest = pyautogui.locateOnScreen('Imagens\\StartQuest.png', confidence=0.7)
            print('Start Quest encontrado \n')
            StartQuest = pyautogui.center(StartQuest)
            pyautogui.click(StartQuest.x, StartQuest.y)
            time.sleep(150)
            return True
        except pyautogui.ImageNotFoundException:
            print('Erro: Imagem "Start Quest" não encontrada na tela.Tentando novamente')
            time.sleep(2)

def localizar_exit():
    print('Tentando sair da Quest...')
    while True:
        try:
            Close = pyautogui.locateOnScreen('Imagens\\Close.png', confidence=0.8)
            Close = pyautogui.center(Close)
            print('Close encontrado \n')
            pyautogui.click(Close.x, Close.y)
            time.sleep(2)

        except pyautogui.ImageNotFoundException:
            print('')
            
        try:
            Exit = pyautogui.locateOnScreen('Imagens\\Exit.png', confidence=0.7)
            print('Saída 1 encontrada \n')
            Exit = pyautogui.center(Exit)
            pyautogui.click(Exit.x, Exit.y)
            time.sleep(0.5)
            pyautogui.click(Exit.x, Exit.y)
            time.sleep(0.5)
            pyautogui.click(Exit.x, Exit.y)
            time.sleep(4)
            return True
        
        except pyautogui.ImageNotFoundException:
            print('Erro: Imagem "Exit" não encontrada na tela.Tentando novamente...')
            time.sleep(2)
    
    

def localizar_exit2():
    print('Tentando sair da Quest...')
    while True:
        try:
            Close = pyautogui.locateOnScreen('Imagens\\Close.png', confidence=0.8)
            Close = pyautogui.center(Close)
            print('Close encontrado \n')
            pyautogui.click(Close.x, Close.y)

        except pyautogui.ImageNotFoundException:
            print('')
            
        try:
            Exit2 = pyautogui.locateOnScreen('Imagens\\Exit2.png', confidence=0.7)
            print('Saída 2 encontrada \n')
            Exit2 = pyautogui.center(Exit2)
            pyautogui.doubleClick(Exit2.x, Exit2.y)
            return True
        
        except pyautogui.ImageNotFoundException:
            print('Erro: Imagem "Exit2" não encontrada na tela.Tentando novamente...')
            time.sleep(2)


def localizar_Close():
    print('Tentando fechar a Quest...')
    while True:
        try:
            Close = pyautogui.locateOnScreen('Imagens\\Close.png', confidence=0.8)
            Close = pyautogui.center(Close)
            print('Close encontrado \n')
            pyautogui.click(Close.x, Close.y)
            time.sleep(2)
            return True
        
        except pyautogui.ImageNotFoundException:
            print('Erro: Imagem "Close" não encontrada na tela.Tentando novamente...')
            time.sleep(2)


def localizar_Retry():
    print('Tentando localizar Retry...')
    while True:
        
        try:
            Close = pyautogui.locateOnScreen('Imagens\\Close.png', confidence=0.8)
            Close = pyautogui.center(Close)
            print('Close encontrado \n')
            pyautogui.click(Close.x, Close.y)
            time.sleep(2)
        
        except pyautogui.ImageNotFoundException:
            print('')
        
        try:
            Retry = pyautogui.locateOnScreen('Imagens\\Retry.png', confidence=0.7)
            print('Retry encontrado \n')
            Retry = pyautogui.center(Retry)
            pyautogui.doubleClick(Retry.x, Retry.y)
            time.sleep(2)
            break
        except pyautogui.ImageNotFoundException:
            print('Erro: Imagem "Retry" não encontrada na tela. Tentando novamente...')
            time.sleep(2)

def localizar_Home():
    print('Tentando localizar Home...')
    while True:
        
        try:
            Close = pyautogui.locateOnScreen('Imagens\\Close.png', confidence=0.8)
            Close = pyautogui.center(Close)
            print('Close encontrado \n')
            pyautogui.click(Close.x, Close.y)
            time.sleep(2)
        
        except pyautogui.ImageNotFoundException:
            print('')
        try:
            Home = pyautogui.locateOnScreen('Imagens\\Home.png', confidence=0.9)
            Home = pyautogui.center(Home)
            print('Home encontrado \n')
            pyautogui.click(Home.x, Home.y)
            time.sleep(4)
            return True
        
        except pyautogui.ImageNotFoundException:
            print('Erro: Imagem "Home" não encontrada na tela.Tentando novamente...')
        
def localizar_BattleIcon():
    print('Tentando localizar BattleIcon...')
    while True:
        try:
            Close = pyautogui.locateOnScreen('Imagens\\Close.png', confidence=0.8)
            Close = pyautogui.center(Close)
            pyautogui.click(Close.x, Close.y)
            time.sleep(2)
        
        except pyautogui.ImageNotFoundException:
            print('')
        try:
            BattleIcon = pyautogui.locateOnScreen('Imagens\\BattleIcon.png', confidence=0.8)
            BattleIcon = pyautogui.center(BattleIcon)
            print('BattleIcon encontrado \n')
            pyautogui.click(BattleIcon.x, BattleIcon.y)
            time.sleep(2)
            return True
        
        except pyautogui.ImageNotFoundException:
            print('Erro: Imagem "BattleIcon" não encontrada na tela.Tentando novamente...')

def localizar_BattleStart():
    print('Tentando localizar BattleStart...')
    while True:
        
        try:
            Close = pyautogui.locateOnScreen('Imagens\\Close.png', confidence=0.8)
            Close = pyautogui.center(Close)
            print('Close encontrado \n')
            pyautogui.click(Close.x, Close.y)
            time.sleep(2)
        
        except pyautogui.ImageNotFoundException:
            print('')
        try:
            BattleStart = pyautogui.locateOnScreen('Imagens\\BattleStart.png', confidence=0.85)
            BattleStart = pyautogui.center(BattleStart)
            print('BattleStart encontrado \n')
            pyautogui.click(BattleStart.x, BattleStart.y)
            time.sleep(25)
            return True
        
        except pyautogui.ImageNotFoundException:
            print('Erro: Imagem "BattleStart" não encontrada na tela.Tentando novamente...')

def localizar_prepare_for_Battle():
    print('Tentando localizar BattleIcon...')
    AttLista=0
    while True:
        try:
            PrepareForBattle = pyautogui.locateOnScreen('Imagens\\PrepareForBattle.png', confidence=0.6)
            PrepareForBattle = pyautogui.center(PrepareForBattle)
            print('PrepareForBattle encontrado \n')
            pyautogui.click(PrepareForBattle.x, PrepareForBattle.y)
            time.sleep(2)
            return True
        
        except pyautogui.ImageNotFoundException:
            print('Erro: Imagem "Prepare For Battle" não encontrada na tela.Tentando novamente...')
            time.sleep(0.5)
            AttLista = AttLista + 1
                             
        if AttLista >= 4:
            try:
                RefreshList = pyautogui.locateOnScreen('Imagens\\RefreshList.png', confidence=0.8)
                RefreshList = pyautogui.center(RefreshList)
                print('RefreshList encontrado \n')
                pyautogui.click(RefreshList.x, RefreshList.y)
                time.sleep(2)
        
            except pyautogui.ImageNotFoundException:
             print('')
             
            try:
                Ok = pyautogui.locateOnScreen('Imagens\\Ok.png', confidence=0.8)
                Ok = pyautogui.center(Ok)
                print('Ok encontrado \n')
                pyautogui.click(Ok.x, Ok.y)
                time.sleep(1)
        
            except pyautogui.ImageNotFoundException:
             print('') 
        
        try:
            Close = pyautogui.locateOnScreen('Imagens\\Close.png', confidence=0.8)
            Close = pyautogui.center(Close)
            print('Close encontrado \n')
            pyautogui.click(Close.x, Close.y)
            time.sleep(2)
        
        except pyautogui.ImageNotFoundException:
            print('')

def localizar_ExitBattle():
    print('Tentando localizar BattleIcon...')
    while True:
             
        try:
            Close = pyautogui.locateOnScreen('Imagens\\Close.png', confidence=0.8)
            Close = pyautogui.center(Close)
            print('Close encontrado \n')
            pyautogui.click(Close.x, Close.y)
            time.sleep(2)
        
        except pyautogui.ImageNotFoundException:
            print('')
        try:
            ExitBattle = pyautogui.locateOnScreen('Imagens\\ExitBattle.png', confidence=0.8)
            ExitBattle = pyautogui.center(ExitBattle)
            print('ExitBattle encontrado \n')
            pyautogui.click(ExitBattle.x, ExitBattle.y)
            time.sleep(0.5)
            pyautogui.click(ExitBattle.x, ExitBattle.y)
            time.sleep(0.5)
            pyautogui.click(ExitBattle.x, ExitBattle.y)
            return True
        
        except pyautogui.ImageNotFoundException:
            print('Erro: Imagem "Prepare For Battle" não encontrada na tela.Tentando novamente...')
  

     
def OpenGame():
    print('Tentando abrir o jogo...')
    while True:
        try:
            ImgGame = pyautogui.locateOnScreen('Imagens\\ImgGame.png', confidence=0.7)
            print('ImgGame encontrado \n')
            ImgGame = pyautogui.center(ImgGame)
            pyautogui.doubleClick(ImgGame.x, ImgGame.y)
            time.sleep(1)
            break
        except pyautogui.ImageNotFoundException:
            print('Erro: Imagem "ImgGame" não encontrada na tela. Tentando novamente...')
            time.sleep(2)

######### func para manter o loop das quests normais #######
def FuncStart():
    time.sleep(4)
    SoulTickt = 1
    while SoulTickt > 0:
        print('entrou no loop')
        SoulTickt -= 1
        if localizar_start_quest():
            if localizar_exit():
                if localizar_exit2():
                    if localizar_Close():
                         if SoulTickt > 1:
                             localizar_Retry()
                         else:
                             print('indo para a pagina inicial')
                             if localizar_Home():
                                 FuncBattles()
        

    if SoulTickt == 0:
        print('Sem Soultickt \n')                       

def Quests():
    
    if localizar_missoes():
        if localizar_eventos():
            if localizar_ev_atual():
                if localizar_quest():
                    if localizar_dificuldade():
                        if localizar_prepare_for_quest():
                             FuncStart()

def FuncBattles():
    NumBattles = 2
    while NumBattles > 0 :
        if localizar_BattleIcon():
            if localizar_prepare_for_Battle():
                if localizar_BattleStart():
                    if localizar_ExitBattle():
                     NumBattles = NumBattles -1

######### Main #######                              
def main():
    print('Inicio')
    time.sleep(1)
    OpenGame()
    Quests()

    
if __name__ == "__main__":
 main()


